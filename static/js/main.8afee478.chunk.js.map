{"version":3,"sources":["loadTga.js","App.js","index.js"],"names":["loadTga","uint8Array","tga","TgaLoader","load","getImageData","fileCompareFunction","a","b","name","App","setState","useState","completedCount","setCompletedCount","targetCount","setTargetCount","duration","setDuration","isProgressing","setIsProgressing","tgaFiles","setTgaFiles","pdfWidth","setPdfWidth","pdfHeight","setPdfHeight","pdfBackgroundColor","setPdfBackgroundColor","displayPageNumbers","setDisplayPageNumbers","filename","setFilename","convertImagesAndBuildPdfFile","begin","Date","getTime","completedCountLocal","length","Promise","all","map","file","resolve","reader","FileReader","onload","progressEvent","Uint8Array","target","result","imageData","canvas","document","createElement","width","height","ctx","getContext","fillStyle","fillRect","putImageData","imageCompression","canvasToFile","png","maxWidthOrHeight","Math","max","compressedPng","arrayBuffer","pngImageData","initialQuality","fileType","compressedJpg","jpgImageData","pageNumber","Number","parseInt","replace","image","readAsArrayBuffer","images","pdf","jsPDF","orientation","unit","format","deletePage","pdfShortSide","min","forEach","index","addPage","setFillColor","rect","addImage","setFont","setFontSize","setLineWidth","setDrawColor","setTextColor","text","String","align","baseline","renderingMode","save","handleBuildClick","handleInputChangeWith","event","value","handlePdfWidthChange","handlePdfHeightChange","handlePdfBackgroundColorChange","handleFilenameChange","handleDisplayPageNumbers","checked","className","onDragOver","preventDefault","onDrop","dataTransfer","items","droppedTgaFiles","reduce","acc","item","kind","getAsFile","test","type","endsWith","push","sort","accept","multiple","disabled","onChange","files","style","marginBottom","marginTop","onClick","floor","toFixed","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.8afee478.chunk.js","sourcesContent":["import TgaLoader from 'tga-js';\n\nexport default function loadTga(uint8Array) {\n  const tga = new TgaLoader();\n  tga.load(uint8Array);\n  return tga.getImageData();\n};\n","import { useState } from 'react';\nimport imageCompression from 'browser-image-compression';\nimport { jsPDF } from 'jspdf';\n\nimport loadTga from './loadTga';\n\nimport './App.css';\n\nconst fileCompareFunction = (a, b) => a.name < b.name ? -1 : 1; // `a.name !== b.name` is always `true`\n\nfunction App() {\n  const [completedCount, setCompletedCount] = useState(0);\n  const [targetCount, setTargetCount] = useState(0);\n  const [duration, setDuration] = useState(0);\n  const [isProgressing, setIsProgressing] = useState(false);\n  const [tgaFiles, setTgaFiles] = useState([]);\n  const [pdfWidth, setPdfWidth] = useState(960);\n  const [pdfHeight, setPdfHeight] = useState(540);\n  const [pdfBackgroundColor, setPdfBackgroundColor] = useState('#5e5e5e');\n  const [displayPageNumbers, setDisplayPageNumbers] = useState(true);\n  const [filename, setFilename] = useState('generated');\n\n  const convertImagesAndBuildPdfFile = async () => {\n    setIsProgressing(true);\n    const begin = new Date().getTime();\n\n    let completedCountLocal = 0;\n    setCompletedCount(0);\n    setTargetCount(tgaFiles.length + 1);\n\n    const images = await Promise.all(\n      tgaFiles.map(\n        async (file) => new Promise(\n          (resolve) => {\n            const reader = new FileReader();\n            reader.onload = async (progressEvent) => {\n              completedCountLocal += 0.34375; // -2, -4, -5; 0.01011\n              setCompletedCount(completedCountLocal);\n              setDuration(new Date().getTime() - begin);\n\n              const imageData = await loadTga(new Uint8Array(progressEvent.target.result));\n\n              completedCountLocal += 0.5625; // -1, -4; 0.1001\n              setCompletedCount(completedCountLocal);\n              setDuration(new Date().getTime() - begin);\n\n              const canvas = document.createElement('canvas');\n              canvas.width = imageData.width;\n              canvas.height = imageData.height;\n\n              const ctx = canvas.getContext('2d');\n              ctx.fillStyle = pdfBackgroundColor;\n              ctx.fillRect(-10, -10, canvas.width + 20, canvas.height + 20);\n              ctx.putImageData(imageData, 0, 0);\n\n              const png = await imageCompression.canvasToFile(canvas, 'image/png');\n              const compressedPng = await imageCompression(png, { maxWidthOrHeight: Math.max(pdfWidth, pdfHeight) });\n              const pngImageData = new Uint8Array(await compressedPng.arrayBuffer());\n\n              const compressedJpg = await imageCompression(\n                png,\n                { maxWidthOrHeight: Math.max(pdfWidth, pdfHeight), initialQuality: 0.9, fileType: 'image/jpeg' },\n              );\n              const jpgImageData = new Uint8Array(await compressedJpg.arrayBuffer());\n\n              const pageNumber = Number.parseInt(file.name.replace(/^\\D*?(\\d+)\\.tga$/i, '$1'), 10);\n\n              completedCountLocal += 0.09375; // -4, -5; 0.00011\n              setCompletedCount(completedCountLocal);\n              setDuration(new Date().getTime() - begin);\n\n              if (pngImageData.length <= jpgImageData.length * 1.1) {\n                resolve({ pageNumber, image: pngImageData });\n              } else {\n                resolve({ pageNumber, image: jpgImageData });\n              }\n            };\n            reader.readAsArrayBuffer(file);\n          }\n        )\n      )\n    );\n\n    const pdf = new jsPDF({\n      orientation: pdfWidth >= pdfHeight ? 'landscape' : 'portrait',\n      unit: 'pt',\n      format: [pdfWidth, pdfHeight],\n    });\n    pdf.deletePage(1);\n\n    const pdfShortSide = Math.min(pdfWidth, pdfHeight);\n    images.forEach(\n      ({ pageNumber, image }, index) => {\n        pdf.addPage()\n          .setFillColor(pdfBackgroundColor)\n          .rect(-10, -10, pdfWidth + 20, pdfHeight + 20, 'F')\n          .addImage(image, 0, 0, pdfWidth, pdfHeight);\n        if (displayPageNumbers) {\n          pdf.setFont('Helvetica', '', 'Bold')\n            .setFontSize(pdfShortSide * 0.09375)\n            .setLineWidth(pdfShortSide * 0.015625)\n            .setDrawColor('#ffffff')\n            .setTextColor('#000000')\n            .text(\n              String(pageNumber || (index + 1)),\n              pdfWidth * 0.9375,\n              pdfHeight * 0.0625,\n              { align: 'right', baseline: 'top', renderingMode: 'stroke' },\n            )\n            .text(\n              String(pageNumber || (index + 1)),\n              pdfWidth * 0.9375,\n              pdfHeight * 0.0625,\n              { align: 'right', baseline: 'top', renderingMode: 'fill' },\n            );\n        }\n      }\n    );\n\n    pdf.save(`${filename}.pdf`);\n\n    completedCountLocal += 1;\n    setCompletedCount(completedCountLocal);\n    setDuration(new Date().getTime() - begin);\n    setIsProgressing(false);\n  };\n\n  const handleDragOver = (event) => {\n    event.preventDefault();\n  }\n\n  const handleDrop = (event) => {\n    event.preventDefault();\n\n    if (!event.dataTransfer.items) {\n      return;\n    }\n\n    const droppedTgaFiles = [...event.dataTransfer.items]\n      .reduce((acc, item) => {\n        if (item.kind !== 'file') {\n          return acc;\n        }\n\n        const file = item.getAsFile();\n        if (/image\\/targa/i.test(file.type) || file.name.endsWith('.tga')) {\n          acc.push(file);\n        }\n        return acc;\n      }, [])\n      .sort(fileCompareFunction);\n\n    if (droppedTgaFiles.length) {\n      setTgaFiles(droppedTgaFiles);\n    }\n  };\n\n  const handleFileChange = (event) => {\n    setTgaFiles([...event.target.files].sort(fileCompareFunction));\n  };\n\n  const handleBuildClick = async () => {\n    await convertImagesAndBuildPdfFile();\n  };\n\n  const handleInputChangeWith = (setState) => (event) => setState(event.target.value);\n  const handlePdfWidthChange = handleInputChangeWith(setPdfWidth);\n  const handlePdfHeightChange = handleInputChangeWith(setPdfHeight);\n  const handlePdfBackgroundColorChange = handleInputChangeWith(setPdfBackgroundColor);\n  const handleFilenameChange = handleInputChangeWith(setFilename);\n\n  const handleCheckboxChangeWith = (setState) => (event) => setState(event.target.checked);\n  const handleDisplayPageNumbers = handleCheckboxChangeWith(setDisplayPageNumbers)\n\n  return (\n    <div\n      className=\"App\"\n      onDragOver={handleDragOver}\n      onDrop={handleDrop}\n    >\n      <h1>GenCG HD에서 추출한 이미지 PDF로 묶기</h1>\n\n      <h2>1. 이미지 파일 선택</h2>\n\n      <div>\n        <input\n          type=\"file\"\n          accept=\"image/x-targa,image/x-tga,.tga\"\n          multiple={true}\n          disabled={isProgressing}\n          onChange={handleFileChange}\n        />\n      </div>\n\n      <h3 style={{ marginBottom: '0.25rem' }}>\n        * 파일 {tgaFiles.length}개 선택됨\n      </h3>\n      <ol className=\"file-list\" style={{ marginTop: '0.25rem' }}>\n        {tgaFiles.map((file) => <li key={file.name}>{file.name}</li>)}\n      </ol>\n\n      <hr />\n\n      <h2>2. 출력 설정</h2>\n\n      <ul className=\"rows\">\n        <li>\n          <span className=\"col2\">파일명</span>\n          <span className=\"colgroup\">\n            <input\n              className=\"col2\"\n              type=\"text\"\n              value={filename}\n              onChange={handleFilenameChange}\n            />\n            <small>.pdf</small>\n          </span>\n        </li>\n\n        <li>\n          <span className=\"col2\">PDF 크기</span>\n          <span className=\"colgroup\">\n            <input\n              className=\"col2\"\n              type=\"number\"\n              value={pdfWidth}\n              onChange={handlePdfWidthChange}\n            />\n            <span className=\"gap\">x</span>\n            <input\n              className=\"col2\"\n              type=\"number\"\n              value={pdfHeight}\n              onChange={handlePdfHeightChange}\n            />\n          </span>\n        </li>\n\n        <li>\n          <span className=\"col2\">배경색</span>\n          <input\n            className=\"col2\"\n            type=\"color\"\n            value={pdfBackgroundColor}\n            onChange={handlePdfBackgroundColorChange}\n          />\n          <small className=\"col2\">{pdfBackgroundColor}</small>\n        </li>\n\n        <li>\n          <span className=\"col2\">페이지 번호 표시</span>\n          <label className=\"col4\">\n            <input\n              type=\"checkbox\"\n              checked={displayPageNumbers}\n              onChange={handleDisplayPageNumbers}\n            />\n          </label>\n        </li>\n      </ul>\n\n      <hr />\n\n      <h2>3. PDF 생성</h2>\n\n      <ul>\n        <li>\n          아직 메모리 최적화가 안 되어서 메모리를 많이 사용합니다.\n          PDF 생성 완료 후에는 쾌적한 기기 사용을 위해 탭을 닫는 것을 권장합니다.\n        </li>\n        <li>배터리를 사용하는 경우 배터리 소모가 많을 수 있습니다.</li>\n      </ul>\n\n      <ul className=\"rows\">\n        <li>\n          <button\n            className=\"col2\"\n            type=\"button\"\n            disabled={isProgressing || tgaFiles.length === 0}\n            onClick={handleBuildClick}\n          >\n            PDF 생성\n          </button>\n\n          {targetCount > 0 &&\n            <>\n              <progress\n                className=\"col2\"\n                value={completedCount}\n                max={targetCount}\n              >\n                {Math.floor(completedCount / targetCount * 100)}%\n              </progress>\n              <small className=\"col2\">\n                {(completedCount / targetCount * 100).toFixed(2)}%까지 {Math.floor(duration / 1000)}초 경과\n              </small>\n            </>}\n        </li>\n      </ul>\n    </div>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\n\nimport './index.css';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}